{% extends "_layout.twig" %}

{% block content %}
    {% set currentUser = craft.app.user.identity %}
    {% if currentUser %}
        <section class="auth-cta">
            <div>
                <p class="eyebrow" style="margin-bottom:0.35rem;">You're already logged in</p>
                <h2>Welcome back, {{ currentUser.friendlyName ?: currentUser.username }}</h2>
                <p>Visit your account dashboard to update details or continue browsing recipes.</p>
            </div>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
                <a class="btn-primary" href="{{ url('account') }}">Go to account</a>
                <form method="post">
                    {{ csrfInput() }}
                    {{ actionInput('users/logout') }}
                    {{ redirectInput('login') }}
                    <button type="submit" class="btn-secondary" style="border:none;cursor:pointer;">Log out</button>
                </form>
            </div>
        </section>
    {% else %}
        <section class="recipe-single" style="max-width:480px;margin:auto;">
            <h1>Log in</h1>
            <p class="muted">Sign in with your email/username to access favorites and account features.</p>

            {% if craft.app.session.hasFlash('error') %}
                <p style="color:#c00;font-weight:600;">{{ craft.app.session.getFlash('error') }}</p>
            {% endif %}

            <form method="post" accept-charset="UTF-8" style="display:flex;flex-direction:column;gap:1rem;">
                {{ csrfInput() }}
                {{ actionInput('users/login') }}
                {{ redirectInput('account') }}

                <label>
                    <span>Email or username</span>
                    <input type="text" name="loginName" required placeholder="you@example.com" style="width:100%;padding:0.65rem;border-radius:12px;border:1px solid rgba(0,0,0,0.15);">
                </label>

                <label>
                    <span>Password</span>
                    <input type="password" name="password" required placeholder="••••••••" style="width:100%;padding:0.65rem;border-radius:12px;border:1px solid rgba(0,0,0,0.15);">
                </label>

                <label style="display:flex;align-items:center;gap:0.4rem;">
                    <input type="checkbox" name="rememberMe" value="1">
                    <span>Remember me</span>
                </label>

                <button type="submit" class="btn-primary" style="border:none;">Log in</button>
            </form>

            <p class="muted" style="margin-top:1.5rem;">Need an account? <a href="{{ url('register') }}">Create one</a>.</p>
        </section>
    {% endif %}
{% endblock %}
